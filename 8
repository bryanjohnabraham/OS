#include <stdio.h> 
#include <stdlib.h> 
#include <pthread.h> 
#include <math.h> 
 
// Global variables to store results 
double mean_value = 0.0; 
double median_value = 0.0; 
double std_dev_value = 0.0; 
 
// Global array to store integers 
int *numbers; 
int count; 
 
// Comparison function for qsort 
int compare(const void *a, const void *b) { 
    return (*(int*)a - *(int*)b); 
} 
 
// Thread function to calculate mean 
void *calculate_mean(void *arg) { 
    long sum = 0; 
    for (int i = 0; i < count; i++) { 
        sum += numbers[i]; 
    } 
    mean_value = (double)sum / count; 
    printf("Thread 1: Calculated Mean = %.2f\n", mean_value); 
    pthread_exit(0); 
} 
 
// Thread function to calculate median 
void *calculate_median(void *arg) { 
    // Create a copy of the array for sorting 
 
 
    int *sorted = (int *)malloc(count * sizeof(int)); 
    for (int i = 0; i < count; i++) { 
        sorted[i] = numbers[i]; 
    } 
     
    // Sort the array 
    qsort(sorted, count, sizeof(int), compare); 
     
    // Calculate median 
    if (count % 2 == 0) { 
        median_value = (sorted[count/2 - 1] + sorted[count/2]) / 2.0; 
    } else { 
        median_value = sorted[count/2]; 
    } 
     
    printf("Thread 2: Calculated Median = %.2f\n", median_value); 
     
    free(sorted); 
    pthread_exit(0); 
} 
 
// Thread function to calculate standard deviation 
void *calculate_std_dev(void *arg) { 
    // Wait a bit to ensure mean is calculated first 
    pthread_t *mean_thread = (pthread_t *)arg; 
    pthread_join(*mean_thread, NULL); 
     
    double sum_squared_diff = 0.0; 
    for (int i = 0; i < count; i++) { 
        double diff = numbers[i] - mean_value; 
        sum_squared_diff += diff * diff; 
    } 
    std_dev_value = sqrt(sum_squared_diff / count); 
    printf("Thread 3: Calculated Standard Deviation = %.2f\n", 
std_dev_value); 
    pthread_exit(0); 
} 
 
int main(int argc, char *argv[]) { 
    if (argc < 2) { 
        printf("Usage: %s <number1> <number2> ... <numberN>\n", argv[0]); 
        return 1; 
    } 
     
    // Get count of numbers 
    count = argc - 1; 
     
    // Allocate memory for numbers array 
    numbers = (int *)malloc(count * sizeof(int)); 
     
    // Read numbers from command line 
    printf("Input numbers: "); 
    for (int i = 0; i < count; i++) { 
        numbers[i] = atoi(argv[i + 1]); 
        printf("%d ", numbers[i]); 
    } 
    printf("\n\n"); 
     
 
 
    // Create threads 
    pthread_t mean_thread, median_thread, std_dev_thread; 
     
    printf("Creating worker threads...\n\n"); 
     
    // Create mean thread 
    pthread_create(&mean_thread, NULL, calculate_mean, NULL); 
     
    // Create median thread 
    pthread_create(&median_thread, NULL, calculate_median, NULL); 
     
    // Create std_dev thread (pass mean_thread so it can wait) 
    pthread_create(&std_dev_thread, NULL, calculate_std_dev, 
&mean_thread); 
     
    // Wait for median thread to complete 
    pthread_join(median_thread, NULL); 
     
    // Wait for std_dev thread to complete (mean_thread already joined 
inside) 
    pthread_join(std_dev_thread, NULL); 
     
    // Display results 
    printf("\n========================================\n"); 
    printf("   STATISTICAL ANALYSIS RESULTS\n"); 
    printf("========================================\n"); 
    printf("Mean:               %.2f\n", mean_value); 
    printf("Median:             %.2f\n", median_value); 
    printf("Standard Deviation: %.2f\n", std_dev_value); 
    printf("========================================\n"); 
     
    // Free allocated memory 
    free(numbers); 
     
    return 0; 
}
