#include <stdio.h>

#define MAX 20
#define Q 3   // Quantum for RR

struct Process {
    int pid;
    int at;     // Arrival Time
    int bt;     // Burst Time
    int rt;     // Remaining Time
    int pr;     // Priority
    int wt;     // Waiting Time
    int tat;    // Turnaround Time
};

/* ---------------- FCFS ---------------- */
void FCFS(struct Process p[], int n) {

    int time = 0;
    float avg_wt = 0;

    for(int i=0;i<n;i++) {

        if(time < p[i].at)
            time = p[i].at;

        p[i].wt = time - p[i].at;
        time += p[i].bt;

        avg_wt += p[i].wt;
    }

    printf("\nFCFS Average Waiting Time = %.2f\n", avg_wt/n);
}


/* ---------------- SRTF ---------------- */
void SRTF(struct Process p[], int n) {

    int time = 0, completed = 0;
    float avg_wt = 0;

    while(completed < n) {

        int idx = -1;
        int min = 9999;

        for(int i=0;i<n;i++) {
            if(p[i].at <= time && p[i].rt > 0 && p[i].rt < min) {
                min = p[i].rt;
                idx = i;
            }
        }

        if(idx == -1) {
            time++;
            continue;
        }

        p[idx].rt--;
        time++;

        if(p[idx].rt == 0) {
            completed++;

            int finish = time;
            p[idx].wt = finish - p[idx].bt - p[idx].at;

            avg_wt += p[idx].wt;
        }
    }

    printf("SRTF Average Waiting Time = %.2f\n", avg_wt/n);
}


/* -------- Non-Preemptive Priority -------- */
void Priority(struct Process p[], int n) {

    int time = 0, completed = 0;
    float avg_wt = 0;
    int done[MAX] = {0};

    while(completed < n) {

        int idx = -1;
        int maxp = -1;

        for(int i=0;i<n;i++) {

            if(p[i].at <= time && !done[i] && p[i].pr > maxp) {
                maxp = p[i].pr;
                idx = i;
            }
        }

        if(idx == -1) {
            time++;
            continue;
        }

        p[idx].wt = time - p[idx].at;
        time += p[idx].bt;

        done[idx] = 1;
        completed++;

        avg_wt += p[idx].wt;
    }

    printf("Priority Average Waiting Time = %.2f\n", avg_wt/n);
}


/* ---------------- Round Robin ---------------- */
void RoundRobin(struct Process p[], int n) {

    int time = 0, completed = 0;
    float avg_wt = 0;

    int queue[100], front=0, rear=0;
    int visited[MAX] = {0};

    queue[rear++] = 0;
    visited[0] = 1;

    while(completed < n) {

        int i = queue[front++];

        if(p[i].rt > Q) {

            p[i].rt -= Q;
            time += Q;

        } else {

            time += p[i].rt;
            p[i].rt = 0;

            completed++;

            p[i].wt = time - p[i].bt - p[i].at;
            avg_wt += p[i].wt;
        }

        for(int j=0;j<n;j++) {

            if(!visited[j] && p[j].at <= time) {

                queue[rear++] = j;
                visited[j] = 1;
            }
        }

        if(p[i].rt > 0)
            queue[rear++] = i;

        if(front == rear) {
            time++;
        }
    }

    printf("Round Robin Average Waiting Time = %.2f\n", avg_wt/n);
}


/* ---------------- MAIN ---------------- */
int main() {

    struct Process p[MAX], temp[MAX];
    int n;

    printf("Enter number of processes: ");
    scanf("%d",&n);

    for(int i=0;i<n;i++) {

        p[i].pid = i+1;

        printf("\nProcess P%d\n",i+1);

        printf("Arrival Time: ");
        scanf("%d",&p[i].at);

        printf("Burst Time: ");
        scanf("%d",&p[i].bt);

        printf("Priority: ");
        scanf("%d",&p[i].pr);

        p[i].rt = p[i].bt;
    }


    /* FCFS */
    for(int i=0;i<n;i++) temp[i]=p[i];
    FCFS(temp,n);


    /* SRTF */
    for(int i=0;i<n;i++) temp[i]=p[i];
    SRTF(temp,n);


    /* Priority */
    for(int i=0;i<n;i++) temp[i]=p[i];
    Priority(temp,n);


    /* Round Robin */
    for(int i=0;i<n;i++) temp[i]=p[i];
    RoundRobin(temp,n);


    return 0;
}
