#include <stdio.h>

#define MAX 20

struct Process {
    int at;     // Arrival Time
    int bt;     // Burst Time
    int wt;     // Waiting Time
    int done;   // Completed or not
};

int main() {

    struct Process p[MAX];
    int n;

    int time = 0, completed = 0;
    float avg_wt = 0;

    printf("----- SJF (Non-Preemptive Scheduling) -----\n");

    /* Input */
    printf("Enter number of processes: ");
    scanf("%d", &n);

    for(int i = 0; i < n; i++) {

        printf("\nProcess P%d\n", i+1);

        printf("Arrival Time: ");
        scanf("%d", &p[i].at);

        printf("Burst Time: ");
        scanf("%d", &p[i].bt);

        p[i].done = 0;
    }

    printf("\n----- Scheduling Started -----\n");

    /* SJF Logic */
    while(completed < n) {

        int idx = -1;
        int min_bt = 9999;
        int next_arrival = 9999;

        for(int i = 0; i < n; i++) {

            if(!p[i].done) {

                /* Find shortest job available */
                if(p[i].at <= time && p[i].bt < min_bt) {
                    min_bt = p[i].bt;
                    idx = i;
                }

                /* Find next arriving process */
                if(p[i].at > time && p[i].at < next_arrival)
                    next_arrival = p[i].at;
            }
        }

        /* If no process is ready */
        if(idx == -1) {

            printf("CPU Idle from %d to %d\n", time, next_arrival);

            time = next_arrival;
            continue;
        }

        /* Execute process */
        p[idx].wt = time - p[idx].at;

        printf("Process P%d executed from %d to %d\n",
               idx+1, time, time + p[idx].bt);

        time += p[idx].bt;

        p[idx].done = 1;
        completed++;

        avg_wt += p[idx].wt;
    }

    /* Output */
    printf("\n----- Result -----\n");

    printf("Process\tAT\tBT\tWT\n");

    for(int i = 0; i < n; i++) {

        printf("P%d\t%d\t%d\t%d\n",
               i+1, p[i].at, p[i].bt, p[i].wt);
    }

    printf("\nAverage Waiting Time = %.2f\n", avg_wt/n);

    return 0;
}