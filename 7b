#include <stdio.h> 
#include <stdlib.h> 
#include <string.h> 
#include <unistd.h> 
#include <sys/types.h> 
#include <sys/ipc.h> 
#include <sys/msg.h> 
#include <sys/wait.h> 
#define MAX_TEXT 100 
// Message structure 
struct message { 
long msg_type; 
char msg_text[MAX_TEXT]; 
}; 
// Function to reverse a string 
void reverse_string(char *str) { 
int len = strlen(str); 
for (int i = 0; i < len / 2; i++) { 
char temp = str[i]; 
str[i] = str[len - 1 - i]; 
str[len - 1 - i] = temp; 
} 
} 
int main() { 
key_t key; 
int msgid; 
pid_t pid; 
struct message msg; 
char input_string[MAX_TEXT]; 
// Generate unique key 
key = ftok(".", 'B'); 
// Create message queue 
msgid = msgget(key, 0666 | IPC_CREAT); 
if (msgid == -1) { 
perror("msgget failed"); 
return 1; 
} 
 
 
    pid = fork(); 
     
    if (pid < 0) { 
        fprintf(stderr, "Fork failed\n"); 
        return 1; 
    } 
    else if (pid == 0) { 
        // Child process: Receive, reverse, and send back 
         
        // Receive message from parent 
        msgrcv(msgid, &msg, sizeof(msg.msg_text), 1, 0); 
        printf("Child: Received string: %s\n", msg.msg_text); 
         
        // Reverse the string 
        reverse_string(msg.msg_text); 
        printf("Child: Reversed string: %s\n", msg.msg_text); 
         
        // Send reversed string back to parent 
        msg.msg_type = 2; 
        msgsnd(msgid, &msg, sizeof(msg.msg_text), 0); 
         
        exit(0); 
    } 
    else { 
        // Parent process: Send string and check palindrome 
         
        printf("Enter a string: "); 
        fgets(input_string, MAX_TEXT, stdin); 
        input_string[strcspn(input_string, "\n")] = 0;  // Remove newline 
         
        // Send string to child 
        msg.msg_type = 1; 
        strcpy(msg.msg_text, input_string); 
        msgsnd(msgid, &msg, sizeof(msg.msg_text), 0); 
        printf("Parent: Sent string: %s\n", input_string); 
         
        // Receive reversed string from child 
        msgrcv(msgid, &msg, sizeof(msg.msg_text), 2, 0); 
        printf("Parent: Received reversed string: %s\n", msg.msg_text); 
         
        wait(NULL);  // Wait for child to complete 
         
        // Check if palindrome 
        if (strcmp(input_string, msg.msg_text) == 0) { 
            printf("\nResult: The string IS a palindrome!\n"); 
        } else { 
            printf("\nResult: The string is NOT a palindrome.\n"); 
        } 
         
        // Remove message queue 
        msgctl(msgid, IPC_RMID, NULL); 
    } 
     
    return 0; 
}
